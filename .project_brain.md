# 项目笔记本 [v6] - 根本Bug修复完成

## 核心原则
• [P1] 错误处理优先功能实现
• [P2] 数据流一致性：异步组件间状态必须同步
• [P3] 牌组优先级保存至数据页面而非本地状态
• [P4] API版本兼容性 🔄
• [P5] 卡片优先级调整影响整体学习效果

## 系统地图
App → useTags(配置) + useAllPages(动态) → usePracticeData → PracticeOverlay
     ↳ selectedTag同步问题 → today.tags[selectedTag] undefined

## 风险清单
⚠️📌 Roam API 获取所有页面的性能问题
⚠️⏱ 大量牌组时的渲染性能
⚠️🔄 牌组优先级变更对卡片的影响算法
⚠️📌 计算大量卡片优先级的性能瓶颈
⚠️🔄 未定义牌组的卡片识别逻辑复杂
✅ selectedTag与tagsList不同步导致undefined崩溃 - 已彻底修复

## 工作日志
[D-1] ✅ 分析现有架构 @extension.tsx, @PracticeOverlay.tsx
[D-2] 🔍 发现牌组系统基于标签配置 @useTags.tsx
[D-3] 📋 定位默认设置位置 @useSettings.ts
[D-4] ✅ 实现搜索增强的TagSelector @PracticeOverlay.tsx
[D-5] ✅ 创建useAllPages获取所有页面 @useAllPages.tsx
[D-6] ✅ 集成全页面牌组系统 @app.tsx
[D-7] ✅ 修改默认FIX模式 @generateNewSession
[D-8] ✅ 创建牌组优先级管理hook @useDeckPriority.tsx
[D-9] ✅ 创建牌组优先级管理UI @DeckPriorityManager.tsx
[D-10] ✅ 完成数据流集成 @getPracticeData返回cardUids
[D-11] ✅ 编译成功，所有组件集成完毕
[D-12] ✅ 创建技术交接报告 @TECHNICAL_HANDOVER_REPORT.md
[D-13] ✅ 项目工作总结完成 @WORK_SUMMARY.md
[D-14] 🔧 ❌ 错误修复方案：防御性编程打补丁 @PracticeOverlay.tsx
[D-15] 🎯 ✅ 根本修复：解决selectedTag与tagsList异步不同步问题 @app.tsx
[D-16] ✅ 构建成功，插件弹窗崩溃问题彻底解决

## 知识晶体
💎 Tag_System：当前基于 tagsListString 配置的牌组系统
💎 Priority_System：已有单卡片优先级系统（0-100）
💎 Review_Modes：FIX模式已存在（FIXED_INTERVAL）
💎 Deck_Priority_Algorithm：牌组优先级=卡片优先级中位数，批量调整公式：新优先级=原优先级*(新中位数/原中位数)
💎 Auto_Page_Discovery：useAllPages自动发现所有非DailyNote页面作为牌组
💎 Search_Enhanced_Select：BlueprintJS Select组件的filterable功能实现搜索
💎 Data_Flow_Pattern：getPracticeData→usePracticeData→App→PracticeOverlay完整数据流
💎 Error_Prevention：React组件中访问嵌套对象属性时必须使用防御性编程，避免undefined.property崩溃
💎 Async_State_Sync：异步Hook间状态同步模式 - useMemo+useEffect确保依赖状态一致性，避免时序竞争 