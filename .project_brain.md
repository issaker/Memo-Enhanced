# 项目笔记本 [v8]
## 核心原则
*   [P1] UI数据必须保持一致性。
*   [P2] 异步数据加载需要有明确的加载状态。
*   [P3] 派生状态应使用 `useMemo` 缓存。
*   [P4] 全局统计数据应在数据处理层去重计算。
*   [P5] UI应保持简洁，移除冗余信息。
*   [P6] 移除生产环境中不必要的调试日志。
*   [P7] 项目应保持整洁，移除无关的测试和构建文件。
*   [P8] 对于大规模数据的排序操作，应预构建Map以实现O(1)查找。
*   [P9] **[新增]** 为避免不必要的重渲染，体积庞大的、非驱动UI刷新的数据对象应存储在`useRef`而非`useState`中。

## 系统地图
用户交互(混合模式) → `PracticeOverlay.tsx` → `usePracticeData.tsx` → `queries.ts` → Roam DB

## 风险清单
*   ✅ **[已解决]** ~~数据不一致风险~~
*   ✅ **[已解决]** ~~潜在UI混淆风险~~
*   ✅ **[已解决]** ~~控制台日志过于冗余~~
*   ✅ **[已解决]** ~~项目包含非必要的开发者文件~~
*   ✅ **[已解决]** ~~卡片量大时排序性能低下导致UI卡顿~~ (通过P0/P1优化，主要矛盾已解决)

## 工作日志
*   [D-2] **完成性能优化(P0)**: 使用 `rankMap` 优化了所有关键路径的排序算法。
*   [D-1] **完成编译**: 生成包含P0优化的版本供用户测试。
*   [D-0] **完成性能优化(P1)**: 将`practiceData`从`useState`移至`useRef`，解耦大数据与React渲染，避免不必要的重绘。

## 知识晶体
*   💎 **Single Source of Truth**: 派生状态应在数据处理流水线末端计算一次。
*   💎 **Minimalist UI**: 优先展示核心数据，移除辅助信息。
*   💎 **Production Logging**: 生产代码应移除详细的调试日志。
*   💎 **Code Hygiene**: 定期清理开发依赖和脚本。
*   💎 **Build Process**: 交付前需通过 `npm install` 和 `npm run build` 生成最新生产版本。
*   💎 **Algorithmic Efficiency**: 用 `Map` 预处理数据进行 O(1) 查找，是替代数组 `indexOf` (O(N)) 的关键优化策略。
*   💎 **State vs. Ref**: 将不需要触发UI更新的大型数据结构存储在 `useRef` 中，而仅将驱动UI变化的轻量级数据（如ID、索引、状态标志）放入 `useState`，是React性能优化的关键实践。 