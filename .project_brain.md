# 项目笔记本 [v9]
## 核心原则
*   [P1] UI数据必须保持一致性。
*   [P2] 异步数据加载需要有明确的加载状态。
*   [P3] 派生状态应使用 `useMemo` 缓存。
*   [P4] 全局统计数据应在数据处理层去重计算。
*   [P5] UI应保持简洁，移除冗余信息。
*   [P6] 移除生产环境中不必要的调试日志。
*   [P7] 项目应保持整洁，移除无关的测试和构建文件。
*   [P8] 大数据量场景下应优化排序算法复杂度。
*   [P9] 大对象应存储在 useRef 中。
*   [P10] UI操作按钮必须连接到实际的业务逻辑。
*   [P11] **[新增]** 处理Git推送冲突时，可使用 `git update-index --assume-unchanged <file>` 临时忽略特定文件的变更。
*   [P12] **[新增]** 技术栈复用优于重新造轮子 - 现有组件架构可作为新项目基础。
*   [P13] **[新增]** 移动端适配需谨慎测试 - 样式修改可能影响核心功能登录机制。

## 系统地图
用户交互(混合模式) → `PracticeOverlay.tsx` → `usePracticeData.tsx` → `queries.ts` → Roam DB
牌组管理 → `DeckPriorityManager.tsx` → `handleDeckOffsetApply` → `bulkSaveRankingChanges` → Roam DB
文本处理 → `useCloze.tsx` → 正则匹配 → DOM操作 → 遮挡渲染
块结构 → `CardBlock.tsx` → `fetchBlockInfo` → 层级数据 → 大纲显示

## 风险清单
*   ✅ **[已解决]** ~~所有已知Bug和性能问题~~
*   ✅ **[已解决]** ~~Git推送冲突~~
*   ⚠️📌 **[新识别]** 开源生态竞争激烈 - Obsidian/Logseq已占据市场主导地位
*   ⚠️⏱ **[新识别]** 全栈开发复杂度 - 需要处理存储、同步、跨平台等问题
*   ⚠️🔄 **[新识别]** 用户迁移成本高 - 现有用户已适应Roam/Obsidian工作流
*   ⚠️⚡ **[新增]** 移动端适配风险 - CSS媒体查询可能破坏Roam原生登录流程

## 工作日志
*   [D-3] 完成P0和P1性能优化，大幅提升大数据量下的响应速度。
*   [D-2] 修复了牌组优先级偏移功能无效的bug。
*   [D-1] 修复了因数据脏读导致的"重复卡片"错误。
*   [D-0] **分析渐进阅读软件可行性**: 识别技术基础(FSRS算法、文本遮挡、块结构)，评估市场竞争和开发复杂度
*   [D+1] **成功推送回滚修改**: 移除导致移动端登录问题的样式修改，使用 `git push --force-with-lease` 覆盖GitHub失败版本

## 知识晶体
*   💎 **Single Source of Truth**: 派生状态应在数据处理流水线末端计算一次，作为唯一可信源。
*   💎 **Algorithm Optimization**: 大数据量下用 Map 查找替代 Array 线性搜索。
*   💎 **React Performance**: 将大对象存储在 useRef 中，减少重渲染。
*   💎 **Prefetching Strategy**: 预取下一个即将使用的资源，提升用户感知的响应速度。
*   💎 **UI-Business Logic Connection**: UI操作必须连接到完整的业务逻辑链。
*   💎 **Git Conflict Management**: 使用 `git update-index --assume-unchanged <file>` 可以在合并远程更新时，临时"保护"本地文件不被覆盖，是处理特定文件（如配置文件、README）冲突的有效策略。
*   💎 **Progressive Reading Foundation**: FSRS算法+文本遮挡+块结构管理+React组件化 = 渐进阅读软件核心技术栈已具备
*   💎 **Force Push Strategy**: 使用 `git push --force-with-lease` 比 `--force` 更安全，可覆盖远程失败修改而不丢失他人提交 