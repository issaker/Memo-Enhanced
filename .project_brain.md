# 项目笔记本 [v4]
## 核心原则
*   [P1] 发布流程需包含编译、版本更新、Changelog记录和Git推送。
*   [P2] 遵循 `README.md` 中定义的架构原则进行代码理解。
*   [P3] 所有发布操作需在 `main` 分支执行。
*   [P4] 严格区分开发者交接文档与最终用户文档。
*   [P5] 冲突解决策略：默认以本地文件为准覆盖远程，但 README.md 除外，它应在远程版本基础上修改。 🔄

## 系统地图 (关键模块关系)
- `PracticeOverlay` (主UI) ← `useSettings`, `usePracticeData`, `useDeckPriority`
- `DeckPriorityManager` (优先级管理) ← `useDeckPriority`
- `useSettings` (设置钩子) → [风险#1]
- `useDeckPriority` (优先级钩子) → [风险#2]
- `queries/save` (保存逻辑) → `bulkSaveRankingChanges` → [风险#3]

## 风险清单 (从报告中识别)
- ⚠️📌 **[风险#1] 异步初始化崩溃**: `useSettings` 在加载初期 `tagsListString` 为 `null`，直接操作导致插件崩溃。 (报告称已修复，但需评估其健壮性)
- ⚠️📌 **[风险#2] 依赖未定义崩溃**: `useDeckPriority` 依赖的 `priorityOrder` 数组异步加载，在此期间为 `undefined`，导致调用方法时崩溃。(报告称已修复，但需评估)
- ⚠️⏱ **[风险#3] 批量保存性能瓶颈**: `bulkSaveRankingChanges` 在处理大量卡片（如 >5000 张）时可能存在性能问题。
- ⚠️ **[风险#4] 优先级重复计算**: `useDeckPriority` 每次打开管理器时都重新计算所有牌组的中位数，存在性能优化空间。

## 工作日志 (倒序3条)
- [D-0] 🚀 项目初始化, 准备发布 v2.3.0。
- [D-1] ⚠️ 发现 package.json 版本 (21) 与文档 (v2.3.0) 不匹配。
- [D-2] 收到用户指令：明确了代码冲突的解决策略。

## 知识晶体 (可复用的模式)
- 💎 **AsyncGuard**: 在异步数据返回之前，提供默认值或加载状态，防止下游组件因 `null` 值崩溃。
- 💎 **LazySave**: 将变更暂存于 `state`，在组件卸载或特定时机通过单个函数 `bulkSave` 统一写入。
- 💎 **FetchThenFilter**: 先捞后筛，用 JS 灵活性弥补 Datalog 查询复杂性的短板。
- 💎 Version_Sync: 发布前必须通过脚本或手动方式，确保 package.json, CHANGELOG, 和 Git 标签的版本号完全一致。
- 💎 Git_Conflict_Strategy: 默认用 'git checkout --ours' 强制保留本地版本，但对 README 等协作文档需手动合并。 